{% extends "base.html" %}
{% block content %}
<div class="container-fluid px-0 px-lg-3">
    <h2 class="h4 mb-3">üìà Live Prices</h2>
    
    {% set min_price = data.prices|map(attribute='price')|min %}
    {% set max_price = data.prices|map(attribute='price')|max %}
    {% set spread_pct = ((max_price - min_price) / min_price * 100) if min_price > 0 else 0 %}
    
    <!-- Mobile Price Cards -->
    <div class="d-lg-none">
        {% for price in data.prices %}
        <div class="card mb-2 {{ 'border-success' if price.price == min_price else 'border-danger' if price.price == max_price else '' }}">
            <div class="card-body py-3">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <strong>{{ price.exchange }}</strong>
                        <div class="h4 mb-0">${{ "%.2f"|format(price.price) }}</div>
                        <small class="text-muted">Bid: ${{ "%.2f"|format(price.bid|default(price.price)) }}</small>
                    </div>
                    <div class="text-end">
                        {% if price.price == min_price %}
                        <span class="badge bg-success">BUY</span>
                        {% elif price.price == max_price %}
                        <span class="badge bg-danger">SELL</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- Desktop Price Table -->
    <div class="d-none d-lg-block">
        <div class="card">
            <div class="card-body">
                <div class="alert {{ 'alert-success' if spread_pct > 0.5 else 'alert-secondary' }}">
                    Spread: {{ "%.4f"|format(spread_pct) }}% 
                    {{ '(Arbitrage Opportunity!)' if spread_pct > 0.5 else '(Below threshold)' }}
                </div>
                
                <div class="table-wrapper">
                    <table class="table table-dark table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Exchange</th>
                                <th>Price</th>
                                <th>Bid</th>
                                <th>Ask</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for price in data.prices %}
                            <tr class="{{ 'table-success' if price.price == min_price else 'table-danger' if price.price == max_price else '' }}">
                                <td><strong>{{ price.exchange }}</strong></td>
                                <td class="h5 mb-0">${{ "%.2f"|format(price.price) }}</td>
                                <td>${{ "%.2f"|format(price.bid|default(price.price)) }}</td>
                                <td>${{ "%.2f"|format(price.ask|default(price.price)) }}</td>
                                <td>
                                    {% if price.price == min_price %}
                                    <span class="badge bg-success">‚≠ê BUY</span>
                                    {% elif price.price == max_price %}
                                    <span class="badge bg-danger">üí∞ SELL</span>
                                    {% else %}
                                    <span class="badge bg-secondary">-</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
