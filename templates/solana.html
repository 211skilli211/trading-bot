{% extends "base.html" %}
{% set active = 'solana' %}
{% block content %}
<div class="row g-3">
    <!-- Wallet Info -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-wallet2"></i> Solana Wallet</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <div class="text-muted small">ADDRESS</div>
                    <code class="d-block text-break">{{ solana_address|default('Not connected') }}</code>
                </div>
                <div class="row g-2">
                    <div class="col-6">
                        <div class="text-muted small">SOL BALANCE</div>
                        <h5>{{ "%.4f"|format(sol_balance|default(0)) }} SOL</h5>
                    </div>
                    <div class="col-6">
                        <div class="text-muted small">USDT BALANCE</div>
                        <h5 class="text-success">{{ "%.2f"|format(usdt_balance|default(0)) }} USDT</h5>
                    </div>
                </div>
                <a href="https://solscan.io/account/{{ solana_address }}" target="_blank" class="btn btn-outline-light btn-sm mt-3 w-100">
                    <i class="bi bi-box-arrow-up-right"></i> View on Solscan
                </a>
            </div>
        </div>
        
        <!-- Quick Swap -->
        <div class="card mt-3">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-arrow-left-right"></i> Quick Swap</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label class="form-label">From</label>
                    <select id="inputToken" class="form-select bg-dark text-light border-secondary">
                        <option value="EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v">USDC</option>
                        <option value="Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB">USDT</option>
                        <option value="So11111111111111111111111111111111111111112">SOL</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">To</label>
                    <select id="outputToken" class="form-select bg-dark text-light border-secondary">
                        <option value="So11111111111111111111111111111111111111112">SOL</option>
                        <option value="EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v">USDC</option>
                        <option value="Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB">USDT</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Amount</label>
                    <input type="number" id="swapAmount" class="form-control bg-dark text-light border-secondary" placeholder="0.00" step="0.01">
                </div>
                <button onclick="executeSwap()" class="btn btn-success w-100">
                    <i class="bi bi-lightning-charge"></i> Execute Swap
                </button>
            </div>
        </div>
    </div>
    
    <!-- Arbitrage Opportunities -->
    <div class="col-md-8">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="bi bi-currency-exchange"></i> Triangular Arbitrage</h5>
                <span class="badge bg-info">Jupiter V6</span>
            </div>
            <div class="card-body">
                {% if arbitrage_opportunities %}
                <div class="table-responsive">
                    <table class="table table-dark table-hover">
                        <thead>
                            <tr>
                                <th>Path</th>
                                <th>Input</th>
                                <th>Expected Output</th>
                                <th>Profit</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for opp in arbitrage_opportunities %}
                            <tr class="{% if opp.viable %}table-success{% endif %}">
                                <td><strong>{{ ' â†’ '.join(opp.symbols) }}</strong></td>
                                <td>{{ "%.2f"|format(opp.input) }} {{ opp.symbols[0] }}</td>
                                <td>{{ "%.2f"|format(opp.expected_output) }} {{ opp.symbols[-1] }}</td>
                                <td class="{% if opp.profit >= 0 %}text-success{% else %}text-danger{% endif %} fw-bold">
                                    {{ "%.3f"|format(opp.profit_pct) }}%
                                </td>
                                <td>
                                    {% if opp.viable %}
                                    <span class="badge bg-success">VIABLE</span>
                                    {% else %}
                                    <span class="badge bg-secondary">BELOW THRESHOLD</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <i class="bi bi-search text-muted" style="font-size: 3rem;"></i>
                    <p class="mt-2 text-muted">No arbitrage opportunities detected</p>
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Recent Swaps -->
        <div class="card mt-3">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-clock-history"></i> Recent Swaps</h5>
            </div>
            <div class="card-body">
                {% if recent_swaps %}
                <div class="table-responsive">
                    <table class="table table-dark table-hover">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>From</th>
                                <th>To</th>
                                <th>Amount</th>
                                <th>Tx</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for swap in recent_swaps %}
                            <tr>
                                <td class="small">{{ swap.timestamp[11:16] if swap.timestamp else 'N/A' }}</td>
                                <td>{{ swap.input_token }}</td>
                                <td>{{ swap.output_token }}</td>
                                <td>{{ swap.amount }}</td>
                                <td>
                                    <a href="https://solscan.io/tx/{{ swap.signature }}" target="_blank" class="text-info">
                                        {{ swap.signature[:8] }}... <i class="bi bi-box-arrow-up-right"></i>
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted text-center py-3">No swaps executed yet</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
